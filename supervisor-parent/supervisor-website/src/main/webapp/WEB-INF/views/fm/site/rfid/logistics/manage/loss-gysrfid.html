<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>私享家绿色门窗平台</title>
<meta name="keywords" content="私享家绿色门窗平台,门窗,型材厂,玻璃厂,门窗">
<meta name="description" content="私享家绿色门窗平台,为门窗行业的玻璃厂,型材厂提供产品盘点,物流跟踪,质量溯源服务。致力于推动江苏省房地产建筑行业绿色环保事业。">
<link href="${b.staticPath}style/style.css" rel="stylesheet"
	type="text/css" />
<script src="${b.staticPath}js/jquery.js"></script>
<script src="${b.staticPath}js/tytabs.jquery.min.js" type="text/javascript"></script>
<script src="${b.staticPath}js/jquery.bigautocomplete.js"></script>
<@b.errorInfo/>
<@b.validate/>
<script type="text/javascript">
$(document).ready(function(){
	$("#tabsholder").tytabs({
							prefixtabs:"tabz",
							prefixcontent:"content",
							classcontent:"tabscontent",
							tabinit:"3",
							catchget:"tab2",
							fadespeed:"normal"
							});
});

function rfid(){
	if(confirm('确实要补损吗?')){
	$.post("rfid_loss.htm",$("#wlForm").serialize(),function(data){
		if(data.isOK=='ok'){
			succInfo(function(){
				window.location.href="queryList.htm";
			},"补损成功!");
		}else{
			errorInfo("补损失败!");	
		}
	});
	}
}
$(function(){
	var url_ = "autoContract.htm";
	$("#contractNo").bigAutocomplete({url:url_,callback:function(data){
		alert("fdf");
		getRecord(data.result);
       // $("#memberId").val(data.result);
    }});
	$("#record").change(function() {
		$.post("getRecordInfo.htm",{"recordNo":this.val()},function(data){
			$("#rfid").text(data.str);
		});
	});
	
	$("#rfid_form").Validform({
		tiptype:3,
		datatype:{
			"ys":/^[A-Za-z0-9]+$/,
			"price":/^(([1-9]\d{0,9})|0)(\.\d{1,2})?$/,
			"count":/^[-+]?\d+(\.\d+)?$/,
			"rfidNov":function(gets,obj,curform,regxp){
				var message="";
				var isPass=false;
				$.ajax({
					  url: "batchInfo.htm?rfidNo="+gets,
					  cache: false,
					  async: false,
					  success: function(data){
						  if(data.batch==null){
								//$("#batchNo").val("0");
								//$("#batchNo_span").text("");
								message= data.error;
							}else{
								$("#contract_div").text(data.contratct.contractId);
								//$("#batchNo_span").text(data.batchNo);
								isPass= true;
							}
					  }
					});
				 if(isPass){
					 return isPass;
				 }else{
					 return message;
				 }
				
			}
		},
		callback:function(form){
			gysrfid();
		}
	});
	
});
function getRecord(contractNo){
	$.post("getRecord.htm",{"contractNo":contractNo},function(data){
		var arr=data.str.split(","); 
		if(data.str!=''){
			$("#record").empty();
			for(var i=0;i<arr.length;i++){
				$("#record").append("<option value='"+arr[i]+"'>"+arr[i]+"</option>");
				$.post("getRecordInfo.htm",{"recordNo":arr[i]},function(data){
					$("#rfid").text(data.str);
				});
			}
		}else{
			$("#record").empty();
			$("#record").append("<option value=''>该合同无补损备案</option>");		
		}
		
	});
}
function  gysrfid(){
	if($("#record").val()==''){
		messageInfo("没有补损备案号,不能补损!");
		return;
	}
	var flag=0;
	$.post("getLoss.htm",$("#htForm").serialize(),function(data){
		if(data.isOK=='no'){
			messageInfo("该合同已补损!");	
			flag=1;
			return;
		}
	})
	if(flag==0){
		if(confirm('确实要补损吗?')){
		$.post("rfid_loss.htm",$("#htForm").serialize(),function(data){
			if(data.isOK=='ok'){
				succInfo(function(){
					window.location.href="queryList.htm";
				},"补损成功!");
			}else{
				errorInfo("补损失败!");	
			}
		});
		}
	}else{
		messageInfo("该合同已补损!");
	}
}
function subForm1(){
	  $("#rfid_form").submit();
}
</script>
</head>

<body>
<div id="header" class="fence">
<@b.header />
</div>
<div class="mainBg">
<div class="fence-wide ly-clearFix">
<div class="main pb20">
<div class="yard-190 ly-left leftMenu">
<@b.leftMenu />
</div>
<div class="yard-870 rightSide ly-left">
<div class="heading mb15 ly-clearFix">
  <h1 class="ly-left">
  <span class="title fontYH f20 fb">物流标签补损</span></h1>
</div>
<div class="contBox">
<div id="tabsholder">
<ul class="tabs">
<li id="tabz1"><a href="#">物流标签补损</a></li>
<li id="tabz2"><a href="#">采购合同补损</a></li>
</ul>

<div class="contents">
<form action="javascript:void(0);" id="rfid_form" method="post">
<input type="hidden" name="id" value="${logistics.id}" /> 
<input type="hidden" name="contractNo" value="${logistics.contractNo}" /> 
<input type="hidden" name="newRfid" value="${logistics.rfidNo}" /> 
<div id="content1" class="tabscontent">
<div class="item"><label>物流标签编号</label>${newRfidNo}</div>
<input id="newRfIdNo" type="hidden" name="newRfIdNo" value="${newRfidNo}"/>
<div class="item"><label>破损物流标签编号</label><input class="input input-w180h36" type="text" id="rfidNo" name="rfidNo" value="" datatype="rfidNov" nullmsg="请输入RFID编号" errormsg="输入错误"/></div>
<div class="item" id="contract_div"><label>采购合同号</label></div>
<div class="item" id="batchNo_div"><label>批次</label></div>
<div class="item ly-clearFix"><label>批次详情</label>
<table id="batch_table" border="" cellpadding="0" cellspacing="0" class="tabProdpc ly-left">
                      <col width="45%" />
                      <col width="40%" />
                      <col width="15%" />
                      <tr>
                        <th>产品规格</th>
                        <th>数量（m&sup2;/吨）</th>
                        <th></th>
                      </tr>
                  <#list batch as batch>
                  <tr>
                    <td>${batch.productModel}</td>
					<td>${batch.quantity}</td>
					<td></td>
                  </tr>
                  </#list>
</table>
</div>				
<div class="item mt10">
      <label>&nbsp;</label>
      <a href="javascript:rfid();" class="button button-orange mr15">确定补损</a><a href="javascript:history.go(-1)" class="button button-gray">取消</a>
</div>
</div>
</form>
<form action="" method="post" id="htForm">
<div id="content2" class="tabscontent">
<div class="item">
      <label>补损物流标签编号</label>${logistics.rfidNo}</div>
    <div class="item" title="">
      <label>需补损的合同号</label>
      <input class="input input-w180h36" id="contractNo" value=""/>
    </div>
    <div class="item" title="">
      <label>补损备案号</label> <select name="select" id="record">
            <option selected="selected" value="">该合同无补损备案</option>
            </select></div>
    <div class="item" title="">
      <label>需补损标签编号</label><span id="rfid"></span></div>
    <div class="item mt10">
      <label>&nbsp;</label>
      <a href="javascript:gysrfid();" class="button button-orange mr15" title="">确定补损</a><a href="javascript:history.go(-1)" class="button button-gray">取消</a></div>
  </div>
  </form>
  </div>
</div>
</div>
</div>
</div>
</div>
</div>
<@b.footer /></body>
</html>
