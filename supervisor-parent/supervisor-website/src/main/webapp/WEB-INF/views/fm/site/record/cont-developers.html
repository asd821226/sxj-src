<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>私享家绿色门窗平台</title>
<meta name="keywords" content="私享家绿色门窗平台,门窗,型材厂,玻璃厂,门窗" />
	<meta name="description"
		content="私享家绿色门窗平台,为门窗行业的玻璃厂,型材厂提供产品盘点,物流跟踪,质量溯源服务。致力于推动江苏省房地产建筑行业绿色环保事业。" />
<link href="${b.staticPath}style/style.css" rel="stylesheet" type="text/css" />
<script src="${b.staticPath}js/jquery.js"></script>
<script src="${b.staticPath}js/jquery.paginate.js"></script>
<link href="${b.staticPath}style/jquery.iviewer.css" rel="stylesheet"
	type="text/css" />
<link rel="stylesheet" type="text/css" href="${b.staticPath}style/elastislide.css" />
<script src="${b.staticPath}js/jqueryui.js"></script>
<script src="${b.staticPath}js/intense.js"></script>
<script src="${b.staticPath}js/jquery.iviewer.js" type="text/javascript"></script>
<script src="${b.staticPath}js/jquery.bigautocomplete.js"></script>
<script src="${b.staticPath}js/jquery.paginate.js"></script>
<script src="${b.staticPath}js/jquery.mousewheel.js" type="text/javascript" ></script>
<script src="${b.staticPath}js/jquery.elastislide-style.js" type="text/javascript" ></script>
<script src="${b.staticPath}js/jquery.elastislide.js" type="text/javascript"></script>
<@b.errorInfo/>
	<script>
	jQuery(document).ready(function($) {
		$('.demo-image').click(function() {
			$('.maskdivgen').fadeIn(100);
			$('.viewer').slideDown(200);
		})
		$('.modal-header .close').click(function() {
			$('.maskdivgen').fadeOut(100);
			$('.viewer').slideUp(200);
		})
	})
	
	$(document).ready(function() {
		var imgPath = $("#imgPath").val();
		$.ajaxSetup ({     
		    cache: false 
		}); 
		$.post("${basePath}filesort.htm",{fileId:imgPath},function(imgPaths){
			var j =0;
			for (var i = 0; i < imgPaths.length; i++) {
				j=i+1;
				$("#carousel").append('<li><a href="javascript:void(0);" class="demo-image" data-image="${b.imagePath}'+imgPaths[i]+'"><img src="${b.imagePath}'+imgPaths[i]+'80x100.JPG" alt="" /></a><p>'+j+'</p></li>');
			}
			
			$( '.elastislide-list' ).elastislide({
				orientation : 'horizontal',
				speed : 500,
				easing : 'ease-in-out',
				minItems : 3,
				start : 0,
				onClick : function( el, position, evt ) { 
					var imageSource = el.find("a").attr("data-image");
					$("#viewer2").iviewer({
						src : imageSource,
						mousewheel : true
					});
					el.parent().children("li").removeClass("view");
					el.addClass("view");
					$("#viewer2").children("img").attr("src",imageSource);
					$(".viewer").show();
					$(".modal-header").show();
					$(".maskdivgen").show();
					return false; 
				},
				onReady : function() { return false; },
				onBeforeSlide : function() { return false; },
				onAfterSlide : function() { return false; }
			});
			
		});
	}); 
	
	function save(){
		var id =$("#recordId").val();
		var message = $("#message").val();
		var contractId = $("#contractId").val();
		$.post("confirmRecord.htm",{recordId:id,contractId:contractId,message:message},function(data){
			   if (data.isOK=='ok'){
				succInfo(function(){
					window.location.href="query.htm";
				},"确认成功!");  
			   }else{
				   errorInfo("确认失败!");  
			   }
		})
	}
</script>		
</head>

<body>
	<div id="header" class="fence"><@b.header /></div>
	<div class="mainBg">
		<div class="fence-wide ly-clearFix">
			<div class="main pb20">
				<div class="yard-190 ly-left leftMenu"><@b.leftMenu /></div>
				<div class="yard-870 rightSide ly-left">
					<div class="heading mb15 ly-clearFix">
						<h1 class="ly-left">
							<span class="title fontYH f20 fb">合同备案管理</span>
						</h1>
					</div>
					<div class="contBox">
						<h2 class="fontYH f18 tc mb20">门窗招标合同</h2>
						<input type="hidden" id="recordId" value="${recordId}" />
						<input type="hidden" id="contractId" value="${contractModel.contract.id}" />
						<input type="hidden" id="message" value="${message}" />
						<div class="contInfo">
							<div class="info ly-clearFix">
								<div class="item">
									<label>合同号</label> ${contractModel.contract.contractNo}
								</div>
								<div class="item">
									<label>工程名称</label> ${contractModel.contract.engName}
								</div>
								<div class="item">
									<label>工程地点</label> ${contractModel.contract.engAddress}
								</div>
								<div class="item">
									<label>对应备案号</label> ${contractModel.contract.nowRecordNo}
								</div>
								<div class="item">
									<label>甲方</label> ${contractModel.contract.memberNameA}
								</div>
								<div class="item">
									<label>乙方</label> ${contractModel.contract.memberNameB}
								</div>
								<div class="item">
									<label>签订地点</label> ${contractModel.contract.address}
								</div>
								<div class="item">
									<label>签订时间</label>
									${contractModel.contract.signedDate?string("yyyy年MM月dd日")}
								</div>
								<div class="item">
									<label>工程总价</label> &nbsp;
								</div>
							</div>
							<div class="item">
								<label>&nbsp;</label>
								<table border="0" cellpadding="0" cellspacing="0"
									class="tabProd ly-left">
									<col width="10%" />
									<col width="15%" />
									<col width="30%" />
									<col width="10%" />
									<col width="12%" />
									<col width="10%" />
									<col width="13%" />
									<tr>
										<th>序号</th>
										<th>产品名称</th>
										<th>型号规格</th>
										<th>单位</th>
										<th>单价<span>（元）</span></th>
										<th>数量</th>
										<th>合价<span>（元）</span></th>
									</tr>
									<#assign n = 0> 
						            <#assign m = 0> 
						            <#list contractModel.itemList as item>
						            <#assign n = (n+item.quantity)?int > 
						            <#assign m = (m+item.amount)?int > 
									<tr>
										<td>${item_index}</td>
										<td>${item.productName}</td>
										<td>${item.productModel}</td>
										<td><span class="fontAR ml5">m<sup>2</sup></span></td>
										<td>${item.quantity}</td>
										<td>${item.price}</td>
										<td>${item.amount}</td>
									</tr>
									 </#list>
									<tr class="fb">
										<td>合计</td>
										<td>&nbsp;</td>
										<td>&nbsp;</td>
										<td>&nbsp;</td>
										<td>&nbsp;</td>
										<td>${n}</td>
										<td>${m}</td>
									</tr>
								</table>
							</div>
							<div class="item">
								<label>&nbsp;</label> 
								<input type="hidden" value="${contractModel.contract.imgPath}" id="imgPath" />
								
									<div class="rollBox">
										<ul id="carousel" class="elastislide-list"></ul>
									</div>
							</div>
						</div>
					</div>
					<div class="item mt10">
						<label>&nbsp;</label><a href="javascript:save();"
							class="button button-orange mr15">确认合同备案信息</a><a
							href="contract.html" class="button button-gray">取消</a>
					</div>
				</div>
			</div>
		</div>
	</div>
	</div>
	</div>
	<@b.footer />
	<div class="viewer modal-wrap" style="display: none">
									<div class="modal-header">
										<span class="close">关闭</span>
									</div>
									<div id="viewer2" class="modal-body"></div>
								</div>
	<div class="maskdivgen" style="display: none"></div> 
</body>
</html>
