<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><!-- InstanceBegin template="/Templates/menu-list.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- InstanceBeginEditable name="doctitle" -->
<title>私享家电子商贸平台</title>
<link href="${b.staticPath}style/style.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="${b.staticPath}js/datepicker.css">
<script src="${b.staticPath}js/jquery.js"></script>
<script src="${b.staticPath}js/datepicker.js"></script>
<script src="${b.staticPath}js/datepicker.zh-CN.js"></script>
<script src="${b.staticPath}js/intense.js"></script>
<@b.pageScript/>
<@b.errorInfo/>
<script>
jQuery(document).ready(function($) {
	$('.modal-header .close').click(function(){
		$('.popDemo').slideUp(200);
	});
	$('.passwordBox .popBtn').click(function(){
		$('.popDemo').slideUp(200);
		
	});
});
    function query(page){
   	 	var params=$("#search_form").serialize();
		if(page!=undefined){
		   params=params+"&currentPage="+page;
	  	}
		$.post("${basePath}member/memberList.htm",params,function(data){
			var res=$(data).find("#rightBar").children("#res_table");
			var pager=$(data).find("#rightBar").children("#pager");
			$("#res_table").empty();
			$("#res_table").append(res.html());
			var totalPage=pager.attr("totalPage");
			var currentPage=pager.attr("currentPage");
			loadPage(currentPage,totalPage,query);
		});
   }
   //重置密码
   function resetPwd(id){
	   var pwd;
	   $.post("${basePath}member/initializePwd.htm",{id:id},function(data){
		   if (data.isOK=='ok'){
			   pwd=data.password
			   $("#promptPwd").text("初始密码为："+pwd+"，谢谢!");
			   $('.popDemo').slideDown(200);
		   }
		   else{
				errorInfo(data);
			}
	   });
   }
   //收起菜单
   function swallowing(lable){
	   $("#"+lable).hide();
   }
   //打开菜单
   function openDiv(lable){
	   $("#"+lable).show();
   }
   //修改
   function edit(id){
	   var params=$("#"+id+"_info").find(":input");
		$("#edit_form").append(params.html());
		$.post("${basePath}member/editMember.htm",params,function(data){
			if(data.isOK == 'ok'){
				alert("修改成功");
				query();
			}else{
				errorInfo(data);
			}
		});
   }
   //更改账户状态
   function editState(id,state){
	  $.post("editState.htm",{id:id,state:state},function(data){
		  if (data.isOK=='ok'){
			  query();
		   }else{
				errorInfo(data);
			}
	  });
   }
   
 //更改审核状态
   function editCheckState(id,state){
	  $.post("editCheckState.htm",{id:id,state:state},function(data){
		  if (data.isOK=='ok'){
			  query();
		   }else{
				errorInfo(data);
			}
	  });
   }
window.onload = function() {
var elements = document.querySelectorAll( '.demo-image' );
Intense( elements );
}
</script>
<!-- InstanceEndEditable -->
<!-- InstanceBeginEditable name="head" -->
<!-- InstanceEndEditable -->
</head>
<body>
<@b.header />
<div id="main" class="fence-wide">
<!-- InstanceBeginEditable name="local" -->
<@b.menuPath/>
<div id="mainBg" class="ly-clearFix yard-1200">
 	<div id="leftList">
 	<div id="leftList"><@b.leftMenu /></div>
 	</div>
    <div id="rightBar">
    <!-- InstanceBeginEditable name="rightBar" -->
      <h2 class="title">会员管理</h2>
      <div id="searchBox" class="ly-clearFix">
      <form action="javascript:void(0);" id="search_form">
        <p> 会员ID<input type="text" name="memberNo" id="memberID" value="${query.memberNo}" />
          会员名称<input type="text" name="memberName" id="memberName" value="${query.memberName}" />
          联系人名称<input type="text" name="contacts" id="contacts" value="${query.contacts}" />
          联系人手机<input type="text" name="contactsPhone" id="contactsPhone" value="${query.contactsPhone}" />
          城市 江苏省-
          <select name="area" id="city">
           <option value="">-请选择-</option>
          	<#list cityList as city>
            <option value="${city.id}:${city.name}">${city.name}</option>
            </#list>
          </select>
         营业执照号码
          <input type="text" name="bLicenseNo" id="bLicenseNo" value="${query.bLicenseNo}" /></p>
		  <p>
          节能标识推广证号
          <input type="text" name="energyNo" id="energyNo" value="${query.energyNo}" />
          会员类型
          <select name="memberType" id="type">
           <option value="">-请选择-</option>
            <#list types as type>
            <#if type.id==query.memberType>
            	<option value="${type.getId()}" selected="selected">${type.getName()}</option>
             <#else>
             	<option value="${type.getId()}">${type.getName()}</option>
            </#if>
            </#list>
          </select>
          审核状态
          <select name="checkState" id="checkState">
           <option value="">-请选择-</option>
           <#list checkStates as state>
           <#if state.id=query.checkState>
            <option value="${state.getId()}" selected="selected">${state.getName()}</option>
            <#else>
             <option value="${state.getId()}">${state.getName()}</option>
            </#if>
           </#list>
          </select>
          账户状态
          <select name="memberState" id="memberState">
           <option value="">-请选择-</option>
           <#list states as state>
            <#if state.id=query.memberState>
            <option value="${state.getId()}" selected="selected">${state.getName()}</option>
            <#else>
             <option value="${state.getId()}">${state.getName()}</option>
            </#if>
           </#list>
          </select>
		   会员注册时间段
          <input class="form-control" type="text" datepicker id="time1" name="startDate">
          -
          <input class="form-control" type="text" datepicker id="time2" name="endDate">
          <button class="btn btn-blue ly-right" onclick="query();"><span>查询</span></button>
        </p>
        </form>
      </div>
       <form id="edit_form"></form>
      <@b.pager/>
      <table border="0" cellpadding="0" cellspacing="0" class="tabList" id="res_table">
        <col width="6%" />
        <col width="10%"/>
        <col width="10%"/>
        <col width="10%" />
        <col width="10%" />
        <col width="8%" />
        <col width="8%" />
        <col width="8%" />
        <col width="8%" />
        <col width="8%" />
        <col width="14%" />
        <tr>
          <th>会员ID</th>
          <th>会员名称</th>
          <th>联系人名称</th>
          <th>营业执照号码</th>
          <th>节能标识<br />
            	推广证号</th>
          <th>会员类型</th>
          <th>注册时间</th>
          <th>认证时间</th>
          <th>审核状态</th>
          <th>帐户状态</th>
          <th class="rLine">操作</th>
        </tr>
        <#list memberList as member>
        <tr>
          <td><a href="javascript:openDiv('${member.id}_info');" class="lnk-blue">${member.memberNo}</a></td>
          <td>${member.name}</td>
          <td>${member.contacts}</td>
          <td>${member.getbLicenseNo()}</td>
          <td>${member.getEnergyNo()}</td>
          <td>${member.type.getName()}</td>
          <td><#if (member.regDate??)>${member.regDate?date} </#if></td>
          <td><#if (member.authorDate??)> ${member.authorDate?date} </#if></td>
          <#if (member.checkState.id==0)>
          <td><button class="btn btn-gray" onclick="editCheckState('${member.id}',1)"><span>审核</span></button></td>
          <#elseif (member.checkState.id==1)>
          <td><button class="btn btn-gray" onclick="editCheckState('${member.id}',2)"><span>认证</span></button></td>
          <#elseif (member.checkState.id==2)>
           <td><em class="state verified">已认证</em></td>
          </#if>
          <#if member.state.id==0>
          <td><button class="btn btn-red" onclick="editState('${member.id}',1)"><span>解冻</span></button></td>
           <#elseif member.state.id==1>
           <td><button class="btn btn-red" onclick="editState('${member.id}',0)"><span>冻结</span></button></td>
          </#if>
          
          <td><button class="btn btn-gray btn-password" href="javascript:;" onclick="resetPwd('${member.id}')"><span>初始化密码</span></button></td>
        </tr>
        <tr class="tableInfo" style="display:none;" id="${member.id}_info">
          <td colspan="11">
          <div class="infoBox">
          <ul class="ly-clearFix">
          <input type="hidden" name ="id" value="${member.id}"/>
          <li><label>会员名称</label><input type="text" value="${member.name}" name="name"/></li>
          <li><label>城市</label> 江苏省-
            <select name="area" id="city">
           	<option value="">-请选择-</option>
          	<#list cityList as city>
          	<#if (("32:江苏省,"+city.id+":"+city.name)==member.area)>
          	 <option value="32:江苏省,${city.id}:${city.name}" selected="selected">${city.name}</option>
          	<#else>
            <option value="32:江苏省,${city.id}:${city.name}">${city.name}</option>
            </#if>
            </#list>
          </select>
           	 会员类型
            <select name="type">
              <#list types as type>
                <#if (type.getId()==member.type.getId())>
                      <option value="${type.getId()}" selected="selected">${type.getName()}</option>
                <#else>
                      <option value="${type.getId()}">${type.getName()}</option>
                </#if>
            </#list>
            </select>
          </li>
          <li class="view"><label>营业执照</label><input type="text" name="bLicenseNo" value="${member.getbLicenseNo()}" />
          <p><a href="#" class="lnk-blue lnk-underline demo-image" data-image="${b.imagePath}${member.bLicensePath}">查看缩略图</a></p>
          </li>
          <li class="view"><label >节能标识推广证</label><input name="energyNo" type="text" value="${member.getEnergyNo()}" />
          <p><a href="#" class="lnk-blue lnk-underline demo-image" data-image="${b.imagePath}${member.energyPath}">查看缩略图</a></p>
          </li>
          <li><label>联系人名称</label><input type="text" value="${member.getContacts()}" name="contacts"/></li>
          <li><label>联系人手机</label><input type="text" value="${member.phoneNo}" name="phoneNo"/></li>
          <li><label>公司地址</label><input type="text" value="${member.address}" name="address"/></li>
          <li><label>固定电话</label><input type="text" value="${member.telNum}" name="telNum"/></li>
          <li><label>注册时间</label><#if (member.regDate??)>${member.regDate?date} </#if></li>
          <li><label>认证时间</label><#if (member.authorDate??)> ${member.authorDate?date} </#if></li>
          <li><label>审核状态</label><em class="state normal" id="checkState1">${member.checkState.getName()}</em></li>
          <li><label>帐户状态</label><em class="state verified" id="state1">${member.state.getName()}</em></li>
          <li><label>子帐号</label>${member.getAccountNum()}</li>
          <li><label>总交易额</label>${member.totalAmount}元</li>
          </ul>
          <div class="btnBox"><a href="#" class="button button-orange button-small" onclick="edit('${member.id}_info')">确认修改</a><a href="#" class="button button-gray button-small" onclick="swallowing('${member.id}_info')">收起</a> </div>
          </div>
          </td>
        </tr>
        </#list>
      </table>
    <div class="modal-wrap popDemo passwordBox" style="display:none">
     <div class="modal-header"><span title="关闭" class="close">关闭</span></div>
     <div class="modal-body">
     <div class="tipBox ly-clearFix">
     <span class="icon32 icon-32-info"></span>
     <p class="color-blue fontYH f18" id="promptPwd"></p>
     </div>
     <button class="popBtn">确认</button>
     </div>
     </div>
     <!-- InstanceEndEditable --></div>
</div>
<@b.footer />
</body>
<!-- InstanceEnd --></html>
