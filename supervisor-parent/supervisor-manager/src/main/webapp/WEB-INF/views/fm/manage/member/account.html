<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><!-- InstanceBegin template="/Templates/menu-list.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<#include "manage/base.html">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- InstanceBeginEditable name="doctitle" -->
<title>私享家电子商贸平台</title>
<link href="${staticPath}style/style.css" rel="stylesheet" type="text/css" />
<script src="${staticPath}js/jquery.js"></script>
<script src="${staticPath}js/jquery.paginate.js"></script>
<!-- InstanceEndEditable -->
<!-- InstanceBeginEditable name="head" -->
<!-- InstanceEndEditable -->
</head>
<script type="text/javascript">
function loadPage(currentPage,totalPage){
	$("#pager").paginate({
		count 		: totalPage,
		start 		: currentPage,
		display     : 10,
		border					: true,
		border_color			: '#CCC',
		text_color  			: '#333',
		background_color    	: '#FFF',	
		border_hover_color		: '#ff4400',
		text_hover_color  		: '#ff4400',
		background_hover_color	: '#fff', 
		images					: false,
		mouse					: 'press',
		onChange				: function(page){
			var params=$("#search_form").serialize();
			params=params+"&currentPage="+page;
			$.post("${basePath}system/account-list.htm",params,function(data){
				var res=$(data).find("#rightBar");
				$("#rightBar").empty();
				$("#rightBar").append(res.html());
				var totalPage=$("#pager").attr("totalPage");
				var currentPage=$("#pager").attr("currentPage");
				loadPage(currentPage,totalPage);
				
			});
		}
	});
}

$("#pager").ready(function(){
	loadPage(${query.currentPage},${query.totalPage});
});
</script>
<Script>
   //根据ID删除子帐号
   function del(id){
	   $.post("delAccount.htm",{id:id},function(data){
		   
	   })
	   $("#"+id).remove();
   }
   //查询
   function query(){
	   //$("#serchAccount").submit();  
	   var params=$("#serchAccount").serialize();
		$.post("${basePath}member/account/accountList.htm.htm",params,function(data){
			var res=$(data).find("#rightBar");
			$("#rightBar").empty();
			$("#rightBar").append(res.html());
			var totalPage=$("#pager").attr("totalPage");
			var currentPage=$("#pager").attr("currentPage");
			loadPage(currentPage,totalPage);
		});
	   
   }
   //修改
   function edit(id){
	   var anobj=$("#"+id).children().eq(2);//子帐号名称TD对象
	   var nobj=$("#"+id).children().eq(3);//姓名TD对象
	   var ok=$("#"+id).children().eq(7);//确认的对象
	   var accountName=anobj.text();
	   var name=nobj.text();
	   anobj.html('<input type="text" value='+accountName+' id="accountEdit"/>');
	   nobj.html('<input type="text" value='+name+' id="nameEdit"/>');
	   ok.html('<a href="#" class="confirm" onclick="editOk('+id+')">确认</a><a href="#" class="del" onclick="del('+id+')">删除</a>');
   }
   //确认修改
   function editOk(id){
	   var accountName=$("#accountEdit").val();
	   var name=$("#nameEdit").val();
	   var anobj=$("#"+id).children().eq(2);//子帐号名称TD对象
	   var nobj=$("#"+id).children().eq(3);//姓名TD对象
	   var ok=$("#"+id).children().eq(7);//确认的对象
	   $.post("editAccount.htm",{id:id,accountName:accountName,name:name},function(data){
		   
	   })
	   anobj.html(accountName);
	   nobj.html(name);
	   ok.html('<a  class="edit" onclick="edit('+id+')">修改</a><a href="#" class="del" onclick="del('+id+')">删除</a>');
   }
   //初始化密码
   function resetPwd(id){
	   $.post("initializePwd.htm",{id:id},function(data){
		   if (data.isOK=='ok'){
			   alert('初始密码为:'+data.password+',谢谢!');
		   }
	   })
   }
   //更改状态
   function checkState(id,obj){
	   
	  $.post("editState.htm",{id:id},function(data){
		  if (data.isOK=='ok'){
			  $(obj).children().text(data.state)
		   }
	  })
	
	  
   }
</Script>
<body>
<#include "manage/head.html">
<div id="main" class="fence-wide">
<!-- InstanceBeginEditable name="local" -->
<!-- InstanceEndEditable -->
<div id="mainBg" class="ly-clearFix yard-1200">
    <div id="leftList">
 	<script>$("#leftList").load("${basePath}menu.htm");</script>
 	</div>
    <div id="rightBar">
    <!-- InstanceBeginEditable name="rightBar" -->
      <h2 class="title">会员子帐号管理</h2>
      <div id="searchBox">
      <form action="javascript:void(0);" id="serchAccount">
        <p>上级会员ID<input type="text" name="memberNo" value="${query.memberNo}">
          子帐号ID<input type="text" name="accountId" value="${query.accountId}">
          子帐号名<input type="text" name="accountName" value="${query.accountName}">
          权限
          <select>
          <#list mas as ma>
            <option value="${ma.getId()}">${ma.getName()}</option>
          </#list>
          </select>
	状态
          <select name="state">
           <#list states as state>
           	<#if state.id==query.state>
            <option value="${state.getId()}" selected="selected">${state.getName()}</option>
            <#else>
             <option value="${state.getId()}">${state.getName()}</option>
            </#if>
           </#list>
          </select>
        </p>
        <p> 会员注册时间段
          <input type="text" name="startDate" value="${query.startDate}">
          -
          <input type="text" name="endDate" value="${query.endDate}">
          <button class="btn btn-blue" onclick="query();"><span>查询</span></button>
        </p>
        </form>
    </div>
     <div id="pager" class="jPaginate" totalPage="${query.totalPage}" currentPage="${query.currentPage}"></div> 
      <table border="0" cellpadding="0" cellspacing="0" class="tabList">
        <col width="10%" />
        <col width="10%"/>
        <col width="10%"/>
        <col width="10%" />
        <col width="10%" />
        <col width="10%" />
        <col width="13%" />
        <col width="15%" />
        <col width="12%" />
        <tr>
          <th>子帐号ID</th>
          <th>上级会员ID</th>
          <th>子帐号名</th>
          <th>姓名</th>
          <th>权限</th>
          <th>状态</th>
          <th>注册时间</th>
          <th>子帐号操作</th>
          <th class="rLine">操作</th>
        </tr>
        <#list list as account>
        <tr id="${account.id}">
          <td>${account.accountNo}</td>
          <td>${account.parentId}</td>
          <td>${account.accountName}</td>
          <td>${account.name}</td>
          <td>合同管理</td>
          <td><button class="btn btn-red" onclick="checkState(${account.id},this)"><span>${account.state.getName()}</span></button></td>
          <td>${account.regDate?date}</td>
          <td class="operation"><a  class="edit" onclick="edit(${account.id})">修改</a><a href="#" class="del" onclick="del(${account.id})">删除</a></td>
          <td><button class="btn" onclick="resetPwd(${account.id})"><span>初始化密码</span></button></td>
        </tr>
        </#list>
      </table>
    <!-- InstanceEndEditable --></div>
</div>
<#include "manage/footer.html"> 
</body>
<!-- InstanceEnd --></html>
