<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><!-- InstanceBegin template="/Templates/menu-list.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- InstanceBeginEditable name="doctitle" -->
<title>私享家电子商贸平台</title>
<link href="${b.staticPath}style/style.css" rel="stylesheet" type="text/css" />
<script src="${b.staticPath}js/jquery.js"></script>
<script src="${b.staticPath}js/jquery.paginate.js"></script>
<@b.validate/>
<SCRIPT>
function edit(){
	$("#record_save").submit();
}
$(function(){
	$("#record_save").Validform({
		tiptype:3,
		callback:function(form){
			bind_save();
		}
	});
	
})
//查询
function query(type){
	var contractNo=$("#contractNo").val();
	var memberIdA=$("#memberIdA").val();
	var memberIdB=$("#memberIdB").val();
	if (contractNo==""){
		alert("合同号不能为空！");
		return false;
	}
	/*
	console.log(type);
	console.log(contractNo);
	console.log(memberIdA);
	console.log(memberIdB);
	*/
	$.post("queryRecordNo.htm",{recordType:type,memberIdA:memberIdA,memberIdB:memberIdB,contractNo:contractNo},function(data){
		if (data.erro != "false"){
			if (memberIdA != null && memberIdA !=""){
				$("#memberNameB_edit").text(data.record.memberNameB);
				$("#recordNoB_edit").text(data.record.recordNo);
				$("#recordIdB_edit").val(data.record.id);
			}else{
				$("#memberNameA_edit").text(data.record.memberNameA);
				$("#recordNoA_edit").text(data.record.recordNo);
				$("#recordIdA_edit").val(data.record.id);
			}
			if (data.refContractNo != null && data.refContractNo !=''){
				$("#refContractNo").val(data.refContractNo);
			}
		}
		
	})
}

  function bind_save(){
	  var contractNo=$("#contractNo").val();
	  var refContractNo=$("#refContractNo").val();
	  var recordNo=$("#recordNoA_edit").text();
	  var recordNo2=$("#recordNoB_edit").text();
	  var recordIdB = $("#recordIdB_edit").val();
 	  var recordIdA = $("#recordIdA_edit").val();
	  $.post("banding_save.htm",{contractNo:contractNo,refContractNo:refContractNo,
		  recordNo:recordNo,recordNo2:recordNo2,recordIdB:recordIdB,recordIdA:recordIdA},function(data){
		  if (data.isOK=='ok'){
			  alert("绑定成功!");
			  window.location.href="recordList.htm";
		  }else{
			  alert("绑定失败!");
		  }
	  })
  }
</SCRIPT>
<body>
<@b.header />
<div id="main" class="fence-wide">
<!-- InstanceBeginEditable name="local" -->
<@b.menuPath />
<!-- InstanceEndEditable -->
<div id="mainBg" class="ly-clearFix yard-1200">
    <div id="leftList"><@b.leftMenu /></div>
    <div id="rightBar">
    <!-- InstanceBeginEditable name="rightBar" -->
    <form id="record_save" action="javascript:void(0);">
      <h2 class="title">绑定合同</h2>
      <div class="infoBox binBox f14">
      <ul>
      <li><label>合同号</label><input type="text" value="" id="contractNo"/><button class="btn btn-blue" onclick="query(${record.type.id});return false;"><span>查询</span></button></li>
      <li><label id="memberNameA">甲方名称</label><span id="memberNameA_edit">${record.memberNameA}</span></li>
      	<li><label id="recordNoA">甲方备案号</label><span id="recordNoA_edit"><#if (record.flag.id==flag[0].id)> ${record.recordNo}  <input type="hidden" id="memberIdA" value="${record.memberIdA}"/></#if ></span><input type="hidden" id="recordIdA_edit" value="${record.id}"/></li>
      <li><label id="memberNameB">乙方名称</label><span id="memberNameB_edit">${record.memberNameB}</span></li>
      <li><label id="recordNoB">乙方备案号</label><span id="recordNoB_edit"><#if (record.flag.id==flag[1].id)> ${record.recordNo} <input type="hidden" id="memberIdB" value="${record.memberIdB}"/>  </#if></span><input type="hidden" id="recordIdB_edit" value="${record.id}"/></li>
      <li><label>关联招标合同</label><input type="text" value="" id="refContractNo"  datatype="*1-50" nullmsg="请输入关联合同号"/></li>
      </ul>
      <div class="btnBox"><a href="javascript:void(0);" class="button button-orange button-small" onclick="edit();return false;">绑定</a><a href="javascript:history.go(-1);" class="button button-gray button-small">返回</a> </div>
      </div>
      </form>
    <!-- InstanceEndEditable --></div>
</div>
</div>
<@b.footer />
</body>
<!-- InstanceEnd --></html>
