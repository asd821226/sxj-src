<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><!-- InstanceBegin template="/Templates/menu-list.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<#include "manage/base.html">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- InstanceBeginEditable name="doctitle" -->
<title>私享家电子商贸平台</title>
<link href="${staticPath}style/style.css" rel="stylesheet" type="text/css" />
<script src="${staticPath}js/jquery.js"></script>
<script src="${staticPath}js/intense.js"></script>
<script>
jQuery(document).ready(function($) {
	$('.del').click(function(){
		$('.popDemo').slideDown(200);
	})
	$('.modal-header .close').click(function(){
		$('.popDemo').slideUp(200);
	})
});

function searchSumbit(){
	var params=$("#search_form").serialize();
	$.post("${basePath}system/account-list.htm",params,function(data){
		var res=$(data).find("#rightBar");
		$("#rightBar").empty();
		$("#rightBar").append(res.html());
	});
}

function accountInfo(id){
	$.get("${basePath}system/account-info.htm?accountId="+id,function(data){
		$("#rightBar").empty();
		$("#rightBar").append(data);
	});
}

function roleInfo(id,type){
	$.get("${basePath}system/get_role_function.htm?accountId="+id+"&type="+type,function(data){
		$("#roleInfo_div").empty();
		$("#roleInfo_div").css("display","");
		$("#roleInfo_div").append(data);
	});
}

function closeDiv(divId){
	$("#"+divId).empty();
	$("#"+divId).css("display","none");
}

function toAdd(id){
	$.get("${basePath}system/to_add.htm",function(data){
		$("#rightBar").empty();
		$("#rightBar").append(data);
		
	});
	
}

function edit(id){
	var params=$("#edit_form_"+id).serialize();
	$.post("${basePath}system/edit_account.htm",params,function(data){
		if(data.isOK==true){
			toInfo(id,data);
			alert("修改成功");
		}
		else{
			alert("修改失败");
		}
	});
}

function removeAccount(id){
	$.get("${basePath}system/remove.htm?accountId="+id,function(data){
		if(data.isOK==true){
			searchSumbit();
			alert("删除成功");
		}
		else{
			alert("删除失败");
		}
	})
}

function toInfo(accountId,data){
	
	$("#"+accountId+"_tr").children("#id_hidden").val(data.account.id);
	
	$("#"+accountId+"_tr").children("#functionIds_hidden").val(data.functionIds);
	
	$("#"+accountId+"_tr").children("#name_td").css("display","");
	$("#"+accountId+"_tr").children("#name_td").text(data.account.name);
	$("#"+accountId+"_tr").children("#name_td2").css("display","none");
	$("#"+accountId+"_tr").children("#name_td2").children(":input").val(data.account.name);
	
	$("#"+accountId+"_tr").children("#account_td").css("display","");
	$("#"+accountId+"_tr").children("#account_td").text(data.account.account);
	$("#"+accountId+"_tr").children("#account_td2").css("display","none");
	$("#"+accountId+"_tr").children("#account_td2").children(":input").val(data.account.account);
	
	$("#"+accountId+"_tr").children("#role_td").css("display","");
	$("#"+accountId+"_tr").children("#role_td2").css("display","none");
	
	$("#"+accountId+"_tr").children().children("#edit_a").css("display","");
	$("#"+accountId+"_tr").children().children("#confirm_a").css("display","none");
}

function toEdit(accountId){
	$("#"+accountId+"_tr").children("#name_td").css("display","none");
	$("#"+accountId+"_tr").children("#name_td2").css("display","");
	
	$("#"+accountId+"_tr").children("#account_td").css("display","none");
	$("#"+accountId+"_tr").children("#account_td2").css("display","");
	
	$("#"+accountId+"_tr").children("#role_td").css("display","none");
	$("#"+accountId+"_tr").children("#role_td2").css("display","");
	
	$("#"+accountId+"_tr").children().children("#edit_a").css("display","none");
	$("#"+accountId+"_tr").children().children("#confirm_a").css("display","");
	
}

</script>
<!-- InstanceEndEditable -->
<!-- InstanceBeginEditable name="head" -->
<!-- InstanceEndEditable -->
</head>
<body>
<#include "manage/head.html">
<div id="main" class="fence-wide">
<!-- InstanceBeginEditable name="local" -->
<#include "manage/menu-path.html">
<!-- InstanceEndEditable -->
<div id="mainBg" class="ly-clearFix yard-1200">
   	<div id="leftList">
   	 <script>$("#leftList").load("${basePath}menu.htm");</script>
    </div>
    <div id="rightBar">
    <!-- InstanceBeginEditable name="rightBar" -->
      <h2 class="title">管理员管理</h2>
      <div id="searchBox" class="ly-clearFix">
      <form id="search_form" action="javascript:void(0)">
	          管理员ID<input type="text" name="id" value="${query.id}">
	          姓名<input type="text" name="name" value="${query.name}">
	          帐号<input type="text" name="account" value="${query.account}">
	          权限<select name="functionId">
	           	 <option value="">全部</option>
	             <#list functions as f>
	             	<#if f.id==query.functionId>
	            	<option value="${f.id}" selected="selected">${f.title}</option>
	            	<#else>
	            	<option value="${f.id}">${f.title}</option>
	            	</#if>
	            </#list>
	          </select>
	          <button class="btn btn-blue" onclick="javascript:searchSumbit();"><span>搜索</span></button>&nbsp;&nbsp;
	          
			  <button onclick="javascript:toAdd();" class="btn btn-blue ly-right"><span>新增管理员</span></button>
 	 </form>
    </div>
      <table border="0" cellpadding="0" cellspacing="0" class="tabList">
        <col width="10%" />
        <col width="13%"/>
        <col width="15%"/>
        <col width="10%" />
        <col width="10%" />
        <col width="12%" />
        <col width="15%" />
        <tr>
          <th>管理员ID</th>
          <th>姓名</th>
          <th>帐号</th>
          <th>权限</th>
          <th>操作记录</th>
          <th>操作</th>
          <th class="rLine">&nbsp;</th>
        </tr>
         <#list list as model>
	        <tr id="${model.id}_tr" >
	          <td>${model.id}</td>
	          <td id="name_td">${model.name}</td>
	          <form  id="edit_form_${model.id}">
		          <input id="functionIds_hidden" type="hidden" name="functionIds" value="none" />
		          <input id="id_hidden" type="hidden" name="id" value="${model.id}" />
		          <td id="name_td2" style="display:none"><input type="text" name="name" value="${model.name}" /></td>
		          <td id="account_td">${model.account}</td>
		          <td id="account_td2" style="display:none"><input type="text" name="account" value="${model.account}" /></td>
	          </form>
	          <td id="role_td"><a href="javascript:roleInfo('${model.id}','get');" class="lnk-blue lnk-underline">查询权限</a></td>
	          <td id="role_td2" class="permission" style="display:none" onclick="javascript:roleInfo(${model.id},'edit');"><div id="district_cn" class="dropMenu sltinput"> <span>全部权限</span> <span class="icon"></span> </div></td>
	        
	          <td><a href="javascript:accountInfo(${model.id});" class="lnk-blue lnk-underline">查询</a></td>
	          <td class="operation">
	          	<a id="edit_a" href="javascript:toEdit('${model.id}');" class="edit lnk-blue">修改</a>
	          	<a id="confirm_a" href="javascript:edit('${model.id}');" class="confirm lnk-yellow" style="display:none">确认</a>
	          	<a href="javascript:void(0);" class="del lnk-blue">删除</a>
	          </td>
	          <td><button class="btn"><span>初始化密码</span></button></td>
	        </tr>
        </#list>
      </table>
      <div id="roleInfo_div" class="modal-wrap popDemo dropList" style="display:none;">
	  </div>
      <div id="remove_div" class="modal-wrap popDemo" style="display:none;" accountId="">
        <div class="modal-header">
          <span class="close">关闭</span></div>
        <div class="modal-body popbtnBox">
          <button class="popBtn" onclick="removeAccount('${model.id}');">确认删除</button><button class="popBtn btnGray">取消</button>
        </div>
      </div>
    <!-- InstanceEndEditable --></div>
</div>
<#include "manage/footer.html">
</body>
<!-- InstanceEnd --></html>
